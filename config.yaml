# 基于对比学习预训练与真实解引导微调的MCTS集成框架配置

# 数据配置
data:
  # 预训练数据生成
  pretrain:
    n_expressions: 1000000  # 预训练表达式数量
    n_samples_per_expr: 100  # 每个表达式的数据点数量
    variables_range: [-5, 5]  # 变量取值范围
    noise_level: 0.01  # 噪声水平
    output_path: "data/pretrain/"
  
  # 在线微调数据
  online_finetune:
    n_samples: 1000  # 微调数据点数量
    variables_range: [-5, 5]
    noise_level: 0.01
    output_path: "data/online_finetune/"
  
  # 实战数据
  production:
    n_samples: 1000
    variables_range: [-5, 5]
    noise_level: 0.01
    output_path: "data/production/"

# 模型配置
model:
  # 表达式编码器
  expression_encoder:
    embedding_dim: 512
    n_heads: 8
    n_layers: 6
    dropout: 0.1
    max_seq_length: 128
  
  # 数据编码器
  data_encoder:
    embedding_dim: 512
    n_heads: 8
    n_layers: 6
    dropout: 0.1
    max_features: 100
  
  # 对比学习配置
  contrastive:
    temperature: 0.07
    projection_dim: 256

# MCTS配置
mcts:
  max_depth: 12
  max_iterations: 1000
  max_variables: 5
  exploration_constant: 1.4
  simulation_count: 10
  
  # 缓存管理配置（新增）
  cache_size_limit: 5000        # 缓存大小限制，超过此值会触发自动清理
  cache_cleanup_interval: 100   # 缓存清理间隔（按MCTS迭代次数）
  auto_cleanup_enabled: true    # 是否启用自动缓存清理
  
  # GPU内存管理配置
  gpu_memory_cleanup_interval: 50   # GPU内存清理间隔（迭代次数）
  gpu_memory_threshold_gb: 2.0     # GPU内存清理阈值（GB）
  max_gpu_memory_gb: 3.0          # 最大GPU内存使用阈值（GB）
  
  # 奖励权重
  reward_weights:
    structure_alignment: 0.3  # 结构对齐奖励
    data_alignment: 0.4       # 数据对齐奖励
    accuracy: 0.3             # 真实精度奖励

# 训练配置
training:
  # 统一模型存储目录
  model_dir: "models_weights/"
  # 预训练配置
  pretrain:
    batch_size: 32
    learning_rate: 1e-4
    num_epochs: 100
    weight_decay: 1e-4
    warmup_steps: 1000
    save_steps: 1000
    eval_steps: 1000
  
  # 在线微调配置
  online_finetune:
    batch_size: 8
    learning_rate: 1e-5  # 稍微提高学习率
    mcts_epochs: 50      # MCTS轮数
    eval_steps: 10       # 每多少轮评估一次
    save_steps: 10       # 每多少轮保存一次
    
    # 难负样本池配置
    hard_negative_pool_size: 1000
    hard_negative_threshold: 0.3  # 降低阈值以收集更多样本
    hard_negative_margin: 0.05    # 准确度差异阈值
    
    # 三元组损失配置
    triplet_margin: 1.0
    alignment_loss_weight: 0.5
    
    # 奖励权重配置（覆盖MCTS配置）
    reward_weights:
      accuracy: 0.5
      data_alignment: 0.3
      structure_alignment: 0.2
      complexity: -0.05
      stability: 0.05
      rollout_reward: 0.2

# 优化器配置
optimizer:
  type: "adamw"
  beta1: 0.9
  beta2: 0.999
  epsilon: 1e-8

# 学习率调度器配置
scheduler:
  type: "cosine_with_warmup"
  min_lr_ratio: 0.01

# 日志和可视化配置
logging:
  level: "INFO"
  tensorboard_dir: "results/logs/tensorboard/"
  wandb:
    enabled: true
    project: "symbolic-regression-mcts"
    entity: "iflow-cli"
  save_rewards: true
  save_expressions: true
  plot_frequency: 10

# 输出配置
output:
  results_dir: "results/"
  plots_dir: "results/plots/"
  metrics_dir: "results/metrics/"
  logs_dir: "results/logs/"
  checkpoint_dir: "models_weights/"

# 随机种子
random_seed: 42

# 设备配置
device: "cuda"  # cuda 或 cpu
num_workers: 4